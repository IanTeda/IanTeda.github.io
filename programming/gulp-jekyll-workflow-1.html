<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml title="Ian Teda" href="https://ianteda.com/rss.xml"><link rel="shortcut icon" href=https://ianteda.com/assets/images/favicon.ico><title>Gulp Jekyll Workflow - Part 1 Design Pattern</title><meta name=description content="Part 1 - Gulp design pattern for working with Jekyll website generator"><link rel=author href="https://plus.google.com/u/0/+IanTeda"><link rel=canonical href="https://ianteda.com/programming/gulp-jekyll-workflow-1.html"><link rel=stylesheet href=/assets/styles/main-7d3ad1d217.min.css><script>var host = "ianteda.com";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
      window.location.protocol = "https";</script><!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--></head><body class="home-template nav-closed"><div class=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Close</span></a><ul><li class=nav-home role=presentation><a href="/">Home</a></li><li class=nav-posts role=presentation><a href=/blog>Blog</a></li><li class=nav-now role=presentation><a href=/now.html>Now</a></li><li class=nav-creativity role=presentation><a href=/creativity>Creativity</a></li><li class=nav-engineering role=presentation><a href=/engineering>Engineering</a></li><li class=nav-management role=presentation><a href=/management>Management</a></li><li class=nav-programming role=presentation><a href=/programming>Programming</a></li></ul><a class="subscribe-button icon-feed" href=/rss.xml>Subscribe</a></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head" style="background-image: url(/assets/images/cover-code-gulp.jpg)"><nav class="main-nav overlay clearfix"><a class=blog-logo href="/"><img src=/assets/images/logo-light.png alt="Blog Logo"></a> <a class="menu-button icon-menu" href=#><span class=word>Menu</span></a></nav><div class=vertical><div class="main-header-content inner"><h1 class=page-title>Gulp Jekyll Workflow - Part 1 Design Pattern</h1><h2 class=page-description>Part 1 - Gulp design pattern for working with Jekyll website generator</h2></div></div></header><main class=content role=main><article class=post><header class=post-header><section class=post-meta>Filed Under: <a href=/programming>Programming</a></section></header><section class=post-content><blockquote><p>Always start with the end in mind. So you know what direction to travel<br><cite>â€” Ian Teda</cite></p></blockquote><p>Keeping the end in mind, I listed four design criteria (patterns) to target when writting Gulp tasks. I wanted my workflow to be modern, simple, configurable and modulised.</p><p><strong>Design Criteria/Patterns</strong></p><ol><li>Use ES2015, ECMAScript 2015 (modern): Why? Get accustom to new JavaScript features before they become mainstream.</li><li>Command Line Interface (simple): Why? KISS. Keep It Simple Stupid. A good design is a simple yet functional design.</li><li>Configuration File (configurable): Why? Make changes in one place, watch them permiate. Easier to read and maintain code.</li><li>Modulised Gulp tasks: Why? Makes for more readable, easier to reuse and maintainable code.</li></ol><h2 id=use-es2015httpwwwecma-internationalorgecma-26260-with-gulphttpgulpjscom>1 - Use <a href="http://www.ecma-international.org/ecma-262/6.0/">ES2015</a> with <a href="http://gulpjs.com/">Gulp</a></h2><p>To paraphrase the Babel tagline. Use next generation JavaScript, today with <a href="https://babeljs.io/">Babel</a>. Since the release of Gulp (gulp-cli) version +3.9 <code class=highlighter-rouge>gulp -v</code> it is as easy as 1-2-3 to use ES2015 while writting Gulp tasks <sup id=fnref:using-es6-with-gulp><a href=#fn:using-es6-with-gulp class=footnote>1</a></sup>.</p><p>To get babel plugged into Gulp I used the following 3 steps:</p><p>1 - Install npm packages for Babel and babel presents</p><div class=highlighter-rouge><pre class=highlight><code><span class=nx>npm</span> <span class=nx>install</span> <span class=nx>babel</span><span class=o>-</span><span class=nx>core</span> <span class=nx>babel</span><span class=o>-</span><span class=nx>preset</span><span class=o>-</span><span class=nx>es2015</span> <span class=o>--</span><span class=nx>save</span><span class=o>-</span><span class=nx>dev</span>
</code></pre></div><p>2 - Create a <code class=highlighter-rouge>.babelrc</code> file to enable 2015 presets</p><div class=highlighter-rouge><pre class=highlight><code><span class=p>{</span>
  <span class=s2>"presets"</span><span class=err>:</span> <span class=p>[</span><span class=s2>"es2015"</span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div><p>3 - Rename <code class=highlighter-rouge>gulpfile.js</code> to <code class=highlighter-rouge>gulpfile.babel.js</code></p><p>Done. See, as easy as 1-2-3.</p><h2 id=command-line-interface-with-yargshttpyargsjsorg>2 - Command Line Interface with <a href="http://yargs.js.org/">Yargs</a></h2><p>Paraphrasing the <a href="http://yargs.js.org/">Yargs</a> tagline. Build interactive command line tools by parsing arguments and generating an elegant user interface. Keeping with my design criteria, I refractored the Yargs configuration into a seperate config file <code class=highlighter-rouge>yargs.config.js</code>. Which is then required from within the <code class=highlighter-rouge>gulpfile.babel.js</code>. Keeping things neat and tidy.</p><p>Require Yargs configuration file within <code class=highlighter-rouge>gulpfile.babel.js</code>.</p><div class=highlighter-rouge><pre class=highlight><code><span class=c1>// Command line (CLI) argument</span>
<span class=kd>var</span> <span class=nx>argv</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>"./gulp/yargs.config"</span><span class=p>);</span>
</code></pre></div><p>Setup the user interface and configure the CLI arguments <code class=highlighter-rouge>yargs.config.js</code> <sup id=fnref:node-command-args><a href=#fn:node-command-args class=footnote>2</a></sup>.</p><div class=highlighter-rouge><pre class=highlight><code><span class=cm>/**
 * CLI (YARGS) Configuration
 * @param {yargs} yargs - Module for handling CLI arguments
 * @exports {argv} argv - Argument object
 */</span>
<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>"yargs"</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>usage</span><span class=p>(</span><span class=s2>"Usage: Gulp &lt;task&gt; [-p -prod -production]"</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>command</span><span class=p>(</span><span class=s2>"script"</span><span class=p>,</span> <span class=s2>"Run script tasks"</span><span class=p>,</span> <span class=p>{</span><span class=na>alias</span><span class=p>:</span> <span class=s2>"scripts"</span><span class=p>})</span>
  <span class=p>.</span><span class=kr>boolean</span><span class=p>(</span><span class=s2>"production"</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>alias</span><span class=p>(</span><span class=s2>"production"</span><span class=p>,</span> <span class=p>[</span><span class=s2>"p"</span><span class=p>,</span> <span class=s2>"prod"</span><span class=p>])</span>
  <span class=p>.</span><span class=nx>describe</span><span class=p>(</span><span class=s2>"production"</span><span class=p>,</span> <span class=s2>"Run Gulp tasks in production mode"</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>help</span><span class=p>(</span><span class=s2>"help"</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>alias</span><span class=p>(</span><span class=s2>"help"</span><span class=p>,</span> <span class=s2>"?"</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>argv</span><span class=p>;</span>
</code></pre></div><h2 id=gulp-configuration-file>3 - Gulp Configuration File</h2><p>Make changes in one place, watch them permiate. Which equals easier to read and maintain code.</p><p><code class=highlighter-rouge>gulp.babel.js</code></p><div class=highlighter-rouge><pre class=highlight><code><span class=c1>// Configuration file for gulp tasks</span>
<span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>"./gulp/gulp.config"</span><span class=p>);</span>
</code></pre></div><p><code class=highlighter-rouge>gulp.config.js</code></p><div class=highlighter-rouge><pre class=highlight><code><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
  <span class=na>xyz</span><span class=p>:</span> <span class=p>{</span>
    <span class=na>src</span><span class=p>:</span> <span class=s2>"src/xyz.xyz"</span><span class=p>,</span>
    <span class=na>options</span><span class=p>:</span> <span class=p>{</span>
      <span class=na>a</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
      <span class=na>b</span><span class=p>:</span> <span class=kc>false</span> 
    <span class=p>},</span>
    <span class=na>dest</span><span class=p>:</span> <span class=s2>"src/"</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 id=modulise-gulp-tasks>4 - Modulise Gulp Tasks</h2><p>Modulisation of Gulp tasks makes for more readable, easier to reuse and maintain code.</p><p>Always abstract anything you need to do more than once. With that in mind a requireTask function is used to require task files from within <code class=highlighter-rouge>gulp.babel.js</code>. <sup id=fnref:module-gulp-tasks><a href=#fn:module-gulp-tasks class=footnote>3</a></sup></p><div class=highlighter-rouge><pre class=highlight><code><span class=c1>// Import Gulp module</span>
<span class=kr>import</span> <span class=nx>gulp</span> <span class=nx>from</span> <span class=s2>"gulp"</span><span class=p>;</span>
<span class=c1>// Command line (CLI) argument</span>
<span class=kd>var</span> <span class=nx>argv</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>"./gulp/yargs.config"</span><span class=p>);</span>
<span class=c1>// Configuration file for gulp tasks</span>
<span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>"./gulp/gulp.config"</span><span class=p>);</span>
<span class=c1>// Lazy load plugins, makes for neater source code</span>
<span class=kd>var</span> <span class=nx>plugins</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>"gulp-load-plugins"</span><span class=p>)(</span><span class=nx>config</span><span class=p>.</span><span class=nx>gulpLoadPlugins</span><span class=p>.</span><span class=nx>options</span><span class=p>);</span>

<span class=cm>/**
 * Require Gulp Task
 * @param {task} task - What Gulp task do you require
 * @return {function} function - Returns task function from module export
 */</span>
<span class=kd>function</span> <span class=nx>requireTask</span><span class=p>(</span><span class=nx>task</span><span class=p>)</span> <span class=p>{</span>
  <span class=c1>// Require Gulp task module, passing in Gulp, config, argv and plugin object references</span>
  <span class=k>return</span> <span class=nx>require</span><span class=p>(</span><span class=s2>"./gulp/tasks/"</span> <span class=o>+</span> <span class=nx>task</span> <span class=o>+</span> <span class=s2>".task.js"</span><span class=p>)(</span>
    <span class=nx>gulp</span><span class=p>,</span>
    <span class=nx>config</span><span class=p>,</span>
    <span class=nx>argv</span><span class=p>,</span>
    <span class=nx>plugins</span>
  <span class=p>);</span>
<span class=p>}</span>

<span class=nx>gulp</span><span class=p>.</span><span class=nx>task</span><span class=p>(</span><span class=s2>"scripts:build"</span><span class=p>,</span> <span class=nx>requireTask</span><span class=p>(</span><span class=s2>"nameOfTask"</span><span class=p>));</span>
</code></pre></div><p>The task <code class=highlighter-rouge>./gulp/tasks/nameOfTask.task.js</code> is built up using the <a href="https://nodejs.org/">NodeJS</a> module pattern, returing the task stream. Returning the task stream is important as it allows Gulp to signal async task completion. With task configuration from withing the <code class=highlighter-rouge>gulp.config.js</code> file.</p><div class=highlighter-rouge><pre class=highlight><code><span class=s2>"use strict"</span><span class=p>;</span>
<span class=cm>/**
 * Gulp Task for doing XYZ
 * @param {gulp} gulp - The gulp module passed in
 * @param {config} config - The projects Gulp config file
 * @param {argv} argv - Arguments flagged at the CLI
 * @param {$} $ - Lazy load plugins, save the imports at the start of the file
 * @return {stream} Stream - Task stream to manage XYZ in project
 */</span>
<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>(</span><span class=nx>gulp</span><span class=p>,</span> <span class=nx>config</span><span class=p>,</span> <span class=nx>argv</span><span class=p>,</span> <span class=nx>$</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
  <span class=k>return</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=nx>stream</span> <span class=o>=</span> <span class=nx>gulp</span>
      <span class=c1>// XYZ source files</span>
      <span class=p>.</span><span class=nx>src</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>xyz</span><span class=p>.</span><span class=nx>src</span><span class=p>)</span>
      <span class=c1>// Apply special Gulp source</span>
      <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>$</span><span class=p>.</span><span class=k>if</span><span class=p>(</span>
        <span class=o>!</span><span class=nx>argv</span><span class=p>.</span><span class=nx>prod</span><span class=p>,</span>
        <span class=nx>$</span><span class=p>.</span><span class=nx>specialsource</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>specialsource</span><span class=p>.</span><span class=nx>options</span>
      <span class=p>)</span>
      <span class=c1>// Write stream to destination folder</span>
      <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>gulp</span><span class=p>.</span><span class=nx>dest</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>xyz</span><span class=p>.</span><span class=nx>dest</span><span class=p>));</span>
      
    <span class=k>return</span> <span class=nx>stream</span><span class=p>;</span>
  <span class=p>};</span>
<span class=p>};</span>
</code></pre></div><h2 id=just-show-me-the-repository-already>5 - Just Show Me the Repository Already</h2><p>If you would like to see it in action, check out the repositry for this website at <a href=https://github.com/IanTeda/IanTeda.github.io>https://github.com/IanTeda/IanTeda.github.io</a></p><h5 id=footnotes>Footnotes</h5><div class=footnotes><ol><li id=fn:using-es6-with-gulp><p><a href="https://markgoodyear.com/2015/06/using-es6-with-gulp/">Using ES6 with gulp</a> <a href=#fnref:using-es6-with-gulp class=reversefootnote>&#8617;</a></p></li><li id=fn:node-command-args><p><a href="http://reverentgeek.com/ahoy-parse-ye-node-js-command-args-with-yargs/">Parse ye Node.js command args with yargs!</a> <a href=#fnref:node-command-args class=reversefootnote>&#8617;</a></p></li><li id=fn:module-gulp-tasks><p><a href=http://macr.ae/article/splitting-gulpfile-multiple-files.html>Splitting a gulpfile into multiple files</a> <a href=#fnref:module-gulp-tasks class=reversefootnote>&#8617;</a></p></li></ol></div></section><footer class=post-footer><section class=share><h4>Share this post</h4><a class=icon-twitter href="http://twitter.com/share?text=Gulp Jekyll Workflow - Part 1 Design Pattern&amp;url=https://ianteda.comprogramminggulp-jekyll-workflow-1.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false"><span class=hidden>Twitter</span></a> <a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=https://ianteda.comprogramminggulp-jekyll-workflow-1.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false"><span class=hidden>Facebook</span></a> <a class=icon-google-plus href="https://plus.google.com/share?url=https://ianteda.comprogramminggulp-jekyll-workflow-1.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false"><span class=hidden>Google+</span></a></section></footer></article></main><aside class=read-next><a class=read-next-story style="background-image: url(/assets/images/cover-glob.jpg)" href=/creativity/mental-models.html><section class=post><h2>Mental Models</h2><p>Mental models are an abstraction of reality, a simplification of an incomprehensibly complicated world.</p></section></a> <a class="read-next-story prev" style="background-image: url(/assets/images/cover-old-typewriter.jpg)" href=/programming/gulp-jekyll-github-pages-cloudflare.html><section class=post><h2>Gulp, Jekyll, Github Pages & Cloudflare</h2><p>Simple, fast, flexible, secure & https. Total cost, $15AUD for domain registration.</p></section></a></aside><footer class="site-footer clearfix"><section class=copyright><a href="/">Ian Teda</a> &copy; 2016</section><section class=poweredby>Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href=https://github.com/biomadeira/jasper>Jasper</a></section></footer></div><script src=/assets/scripts/main-bbfa490385.min.js></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-71253711-1', 'auto');
ga('require', 'linkid');
ga('send', 'pageview');</script></body></html>